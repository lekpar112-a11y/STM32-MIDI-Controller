# Nama alur kerja yang akan muncul di tab "Actions" GitHub
name: Build STM32 Firmware

# Pemicu: Alur kerja ini akan berjalan setiap kali ada 'push' ke repositori
on: [push]

jobs:
  build-firmware:
    # Nama tugas yang akan berjalan
    name: Build and Upload Firmware
    
    # Menjalankan tugas ini di lingkungan Ubuntu versi terbaru
    runs-on: ubuntu-latest

    steps:
      # Langkah 1: Mengunduh kode dari repositori Anda (diperbarui ke v4)
      - name: Checkout repository
        uses: actions/checkout@v4

      # Langkah 2: Menginstal Python (diperbarui ke v5)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      # Langkah 3: Menginstal PlatformIO CLI
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install -U platformio

      # Langkah 4: Menjalankan proses kompilasi (build)
      - name: Build PlatformIO project
        run: pio run -e bluepill_f103c6

      # Langkah 5: Mengunggah hasil kompilasi (firmware.bin) sebagai artefak
      # --- INI ADALAH PERUBAHAN UTAMA ---
      # Versi diperbarui dari @v3 ke @v4 untuk memperbaiki error
      - name: Upload firmware artifact
        uses: actions/upload-artifact@v4
        with:
          name: firmware-bin
          path: .pio/build/*/firmware.bin
