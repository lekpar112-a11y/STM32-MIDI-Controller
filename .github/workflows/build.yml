# Nama alur kerja yang akan muncul di tab "Actions" GitHub
name: Build STM32 Firmware

# Pemicu: Alur kerja ini akan berjalan setiap kali ada 'push' ke repositori
on: [push]

jobs:
  build-firmware:
    # Nama tugas yang akan berjalan
    name: Build and Upload Firmware
    
    # Menjalankan tugas ini di lingkungan Ubuntu versi terbaru
    runs-on: ubuntu-latest

    steps:
      # Langkah 1: Mengunduh kode dari repositori Anda
      - name: Checkout repository
        uses: actions/checkout@v3

      # Langkah 2: Menginstal Python, yang dibutuhkan oleh PlatformIO
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # Langkah 3: Menginstal PlatformIO CLI
      - name: Install PlatformIO
        run: |
          python -m pip install --upgrade pip
          pip install -U platformio

      # Langkah 4: Menjalankan proses kompilasi (build)
      # Perintah ini secara spesifik menggunakan environment 'bluepill_f103c6' dari file platformio.ini Anda
      - name: Build PlatformIO project
        run: pio run -e bluepill_f103c6

      # Langkah 5: Mengunggah hasil kompilasi (firmware.bin) sebagai artefak
      # Path menggunakan wildcard (*) agar lebih fleksibel dan tidak error lagi
      - name: Upload firmware artifact
        uses: actions/upload-artifact@v3
        with:
          name: firmware-bin
          path: .pio/build/*/firmware.bin
